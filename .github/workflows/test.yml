name: C Assignments - Test Utility

on: 
  push: 
    branches: [ "main" ]

jobs: 
  test:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4

    - name: Build convert
      run: make convert

    - name: Run Tests
      run: ./test_script.sh > test_results.txt

    - name: Generate Coverage Report
      run: |
        gcov convert.c
        gcov convertNum.c
        gcov convertUsageHelp.c

    - name: Upload convert Executable            
      uses: actions/upload-artifact@v4    
      with:
        name: convert            
        path: ./convert

    - name: Upload Test Results
      if: ${{ always() }}
      uses: actions/upload-artifact@v4
      with:
        name: Test Results
        path: ./test_results.txt
    
    - name: Upload Coverage Report            
      uses: actions/upload-artifact@v4    
      with:
        name: coverage-report            
        path: "*.gcov"
